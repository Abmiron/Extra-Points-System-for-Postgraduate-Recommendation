# GradPush 系统部署指南（大白话版）----有很多缺陷，仅用于参考

## 一、先说说这是个啥系统

GradPush 是一个用于管理大学生推免（推荐免试研究生）的系统，简单来说就是帮学校和老师管理学生推免申请的软件。

这个系统分两部分：
- **前端**：就是我们在浏览器里看到的界面，比如登录页面、申请表格这些（基于Vue 3 + Vite开发）
- **后端**：就是看不见的部分，负责处理数据、保存信息这些工作（基于Flask开发）

## 二、得先准备个服务器

### 1. 选个合适的服务器

就像咱们家里要有个电脑才能上网一样，系统也需要一个"电脑"来运行，这个"电脑"就是服务器。推荐选这几家的云服务器（就像租一个放在网上的电脑）：
- 阿里云ECS（建议选2核4G内存，40GB硬盘，5Mbps网速）
- 腾讯云CVM（同上配置）
- 华为云ECS（同上配置）

### 2. 装个简单的操作系统

服务器上要装个操作系统，推荐用：
- CentOS 7.9 或者 Ubuntu 22.04 LTS

这两个系统比较稳定，后面好管理。

### 3. 安装宝塔面板（重要！）

宝塔面板就像给服务器装了个"老人机界面"，让我们不用记复杂的命令，用鼠标点点就能操作服务器。

#### 3.1 先登录到服务器

用SSH工具（比如Xshell、FinalShell）登录到你租的服务器，就像我们用账号密码登录微信一样。

#### 3.2 安装宝塔面板

登录后，复制下面的命令粘贴进去，按回车：

如果你的服务器是CentOS系统：
```bash
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

如果是Ubuntu系统：
```bash
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

等一会儿，安装完成后，会出现一个网址、用户名和密码，一定要记下来！

#### 3.3 登录宝塔面板

打开浏览器，输入刚才记下来的网址，用记下来的用户名和密码登录。

#### 3.4 安装必要的软件

登录后，找到"软件商店"，安装这些软件：
1. **Nginx**：就像服务器的"门童"，负责接待访问系统的人
2. **PostgreSQL**：数据库，用来存系统里的所有数据（比如学生信息、申请记录）
3. **Python项目管理器**：用来运行后端程序
4. **Node.js**：用来构建前端界面（选20.x版本，项目要求Node.js ^20.19.0 || >=22.12.0）
5. **Git**：版本控制工具（可选）

## 三、配置数据库

### 1. 安装PostgreSQL数据库

1. 登录宝塔面板，进入"软件商店"
2. 搜索"PostgreSQL"，找到"PostgreSQL管理器"点击安装
3. 打开"PostgreSQL管理器"，点击"安装PostgreSQL"，选推荐版本（比如15）

### 2. 配置数据库

1. 在"PostgreSQL管理器"里，点击"设置"
2. 把"监听地址"改成"localhost"（这样更安全）
3. 点"保存"，然后重启PostgreSQL服务

### 3. 创建数据库和用户

1. 在"PostgreSQL管理器"里，点击"数据库"标签
2. 点击"创建数据库"按钮
3. 填写这些信息：
   - 数据库名：就填`gradpush`
   - 用户名：也填`gradpush`
   - 密码：设一个复杂点的密码，比如"GradPush@2024"（一定要记下来！）
   - 编码：默认的UTF8就行
4. 点"创建"按钮

## 四、部署后端程序

### 1. 上传代码

#### 1.1 先建个文件夹

1. 登录宝塔面板，进入"文件"管理
2. 在网站根目录（比如`/www/wwwroot/`）下建一个叫`gradpush`的文件夹
3. 在`gradpush`文件夹里再建两个子文件夹：`backend`（放后端代码）和`frontend`（放前端代码）

#### 1.2 上传后端代码

把你本地电脑上的`backend`文件夹里的所有文件，都上传到服务器上的`/www/wwwroot/gradpush/backend/`文件夹里。

### 2. 修改配置文件

#### 2.1 修改`backend/config.py`文件

1. 在宝塔面板里找到`/www/wwwroot/gradpush/backend/config.py`文件，点击编辑
2. 修改这些内容：
   ```python
   class Config:
       # 数据库配置 - 改成你刚才设的密码
       SQLALCHEMY_DATABASE_URI = "postgresql://gradpush:你刚才设的密码@localhost:5432/gradpush"
       SQLALCHEMY_TRACK_MODIFICATIONS = False
       
       # 密钥配置 - 改成一个复杂点的字符串，比如"GradPushSecretKey2024"
       SECRET_KEY = "GradPushSecretKey2024"
       
       # 文件上传配置
       UPLOAD_FOLDER = os.path.join(os.getcwd(), "uploads")
       AVATAR_FOLDER = os.path.join(UPLOAD_FOLDER, "avatars")
       FILE_FOLDER = os.path.join(UPLOAD_FOLDER, "files")
       GRADUATE_FILES_FOLDER = os.path.join(UPLOAD_FOLDER, "graduate-files")
       MAX_CONTENT_LENGTH = 100 * 1024 * 1024  # 100MB，支持多文件上传
       
       # Session配置
       SESSION_TYPE = 'filesystem'  # 使用文件系统存储session
       SESSION_FILE_DIR = os.path.join(os.getcwd(), 'cache')  # session文件存储路径
       SESSION_PERMANENT = False  # 不是永久session
       SESSION_USE_SIGNER = True  # 使用签名
       SESSION_KEY_PREFIX = 'gradpush:'  # session键前缀
       PERMANENT_SESSION_LIFETIME = 1800  # session有效期（秒）
   ```
3. 点"保存"按钮

#### 2.2 修改`backend/app.py`文件

1. 找到`/www/wwwroot/gradpush/backend/app.py`文件，点击编辑
2. 把调试模式改成False：
   ```python
   if __name__ == "__main__":
       app.run(debug=False, port=5001, use_reloader=False)
   ```
3. 确保所有蓝图都使用了`/api`前缀（统一前后端路径）：
   ```python
   # 注册蓝图
   app.register_blueprint(public_bp, url_prefix='/api')  # 公开接口蓝图，无需认证
   app.register_blueprint(auth_bp, url_prefix='/api')
   app.register_blueprint(user_bp, url_prefix='/api')
   app.register_blueprint(application_bp)  # application_bp 已经在定义时设置了 url_prefix='/api'
   app.register_blueprint(rule_bp, url_prefix='/api')
   app.register_blueprint(admin_bp, url_prefix='/api')
   app.register_blueprint(score_bp)  # score_bp 已经在定义时设置了 url_prefix='/api'
   app.register_blueprint(organization_bp)  # organization_bp 已经在定义时设置了 url_prefix='/api/organization'
   app.register_blueprint(system_bp)  # system_bp 已经在定义时设置了 url_prefix='/api/system'
   app.register_blueprint(main_bp)
   ```
4. 点"保存"按钮

### 3. 创建必要的文件夹

1. 在宝塔面板里找到`/www/wwwroot/gradpush/backend/`文件夹
2. 创建以下子文件夹：
   - `uploads/`
   - `uploads/avatars/`
   - `uploads/files/`
   - `uploads/graduate-files/`
   - `cache/`
   - `logs/`

### 4. 用Python项目管理器部署后端

1. 打开宝塔面板，进入"软件商店"，找到"Python项目管理器"点击"设置"
2. 点击"添加项目"按钮
3. 填写这些信息：
   - 项目路径：选`/www/wwwroot/gradpush/backend`
   - Python版本：选3.8以上的版本
   - 框架：选Flask
   - 启动方式：选Gunicorn
   - 应用名称：填`app:app`
   - 端口：填5001
4. 点"确认"按钮

### 5. 安装依赖

1. 在Python项目列表里，找到刚创建的项目，点击"管理"
2. 进入"依赖管理"标签
3. 点击"从requirements.txt安装"按钮
4. 选择`/www/wwwroot/gradpush/backend/requirements.txt`文件
5. 点"安装"按钮

### 6. 初始化数据库

1. 在Python项目管理界面，进入"终端"标签
2. 输入下面的命令，每行输完按回车（创建数据库表结构）：
   ```bash
   flask db init
   flask db migrate -m "Initial migration"
   flask db upgrade
   ```
3. 然后运行下面的命令，初始化基础数据（包括管理员账号、学院、系、专业等）：
   ```bash
   python init_db.py --auto
   ```
   
   **默认管理员账号**：
   - 用户名：`admin`
   - 密码：`123456`

### 7. 启动后端服务

1. 在Python项目管理界面，点击"启动"按钮
2. 确认服务状态显示为"运行中"

## 五、部署前端界面

### 1. 上传前端代码

把你本地电脑上的`frontend`文件夹里的所有文件，都上传到服务器上的`/www/wwwroot/gradpush/frontend/`文件夹里。

### 2. 修改前端代理配置（可选）

1. 在宝塔面板里找到`/www/wwwroot/gradpush/frontend/vite.config.js`文件，点击编辑
2. 修改代理配置，确保指向正确的后端地址（现在所有请求都通过/api代理，不再需要单独的/public代理）：
    ```javascript
    server: {
      proxy: {
        '/api': {
          target: 'http://localhost:5001',
          changeOrigin: true,
          secure: false
        },
        '/uploads': {
          target: 'http://localhost:5001',
          changeOrigin: true,
          secure: false
        }
      }
    }
    ```
3. 点"保存"按钮

### 3. 构建前端应用

1. 在宝塔面板里找到`/www/wwwroot/gradpush/frontend/`文件夹，点击右侧的"终端"按钮
2. 输入下面的命令，每行输完按回车：
   ```bash
   npm install
   npm run build
   ```
3. 等一会儿，构建完成后，会在`/www/wwwroot/gradpush/frontend/`文件夹里生成一个叫`dist`的文件夹

### 4. 创建网站

1. 登录宝塔面板，进入"网站"管理
2. 点击"添加站点"按钮
3. 填写这些信息：
   - 域名：填你自己的域名（比如`your-domain.com`）
   - 根目录：选`/www/wwwroot/gradpush/frontend/dist/`
   - PHP版本：选"纯静态"
4. 点"提交"按钮

## 六、配置Nginx（网站门童）

### 1. 配置反向代理

反向代理就是让Nginx把不同的请求送到不同的地方处理，比如把访问网站的请求送到前端，把访问数据的请求送到后端。

1. 登录宝塔面板，进入"网站"管理
2. 找到你刚才创建的网站，点击"设置"
3. 进入"反向代理"标签
4. 点击"添加反向代理"按钮

#### 1.1 配置API代理

- 代理名称：就填"API代理"
- 目标URL：填`http://127.0.0.1:5001/api`
- 其他设置都用默认的就行
- 点"保存"按钮

#### 1.2 配置文件上传下载代理

- 代理名称：填"文件上传下载代理"
- 目标URL：填`http://127.0.0.1:5001/uploads`
- 其他设置和API代理一样
- 点"保存"按钮

**注意**：不再需要配置单独的"公开接口代理"，因为所有公开接口现在都通过`/api`前缀访问了。

### 2. 配置前端路由重写

1. 在网站设置里，进入"伪静态"标签
2. 选择"Vue"或者"VuePress"的伪静态规则（如果没有，就复制下面的内容粘贴进去）：
   ```nginx
   location / {
       try_files $uri $uri/ /index.html;
   }
   ```
3. 点"保存"按钮

### 3. 配置文件上传大小限制

1. 在网站设置里，进入"配置文件"标签
2. 在`http`块中添加以下配置（如果已存在则修改）：
   ```nginx
   client_max_body_size 100m;
   ```
3. 点"保存"按钮

### 4. 重启Nginx服务

1. 在宝塔面板里，进入"软件商店"
2. 找到已安装的"Nginx"，点击"设置"
3. 点击"重启"按钮

## 七、配置SSL证书（让网站更安全）

SSL证书可以让你的网站变成HTTPS开头，这样访问更安全，就像微信聊天加密一样。

### 1. 申请免费的SSL证书

1. 登录宝塔面板，进入"网站"管理
2. 找到你的网站，点击"设置"
3. 进入"SSL"标签
4. 在"证书类型"里选"Let's Encrypt"
5. 勾选你的域名（比如your-domain.com、www.your-domain.com）
6. 勾选"自动申请SSL证书"
7. 点"申请"按钮

### 2. 开启强制HTTPS

1. 在"SSL"标签里，找到"强制HTTPS"选项
2. 点击"开启"按钮

这样所有人访问你的网站时，都会自动跳转到HTTPS的安全链接。

## 八、安全配置（很重要！）

### 1. 配置防火墙

1. 登录宝塔面板，进入"安全"管理
2. 找到"防火墙"功能
3. 点击"添加规则"按钮，开放这些端口：
   - HTTP：80（用来访问网站）
   - HTTPS：443（用来安全访问网站）
   - 后端应用：5001（用来运行后端程序）
4. 确认规则已添加并启用

### 2. 设置文件权限

1. 进入"文件"管理
2. 找到前端目录 `/www/wwwroot/gradpush/frontend/`：
   - 右键点击目录，选择"权限"
   - 设置所有者为 `www`，用户组为 `www`
   - 设置权限为 `755`
3. 找到后端目录 `/www/wwwroot/gradpush/backend/`：
   - 右键点击目录，选择"权限"
   - 设置所有者为 `www`，用户组为 `www`
   - 设置权限为 `755`
4. 找到后端的上传和缓存目录：
   - `/www/wwwroot/gradpush/backend/uploads/` 及其子目录
   - `/www/wwwroot/gradpush/backend/cache/`
   - `/www/wwwroot/gradpush/backend/logs/`
   - 设置权限为 `755` 或者 `775`（确保有写入权限）

### 3. 其他安全设置

- **登录保护**：在"面板设置"里开启"登录保护"，设置只有你自己的IP能登录宝塔面板
- **异地登录提醒**：在"面板设置"里开启"异地登录提醒"，如果有人从别的地方登录你的面板，你会收到提醒
- **安全加固**：在"安全"管理里，点击"安全加固"，按照提示做一些安全设置

## 九、性能优化（让网站跑得更快）

### 1. 优化Nginx

1. 进入"软件商店"，找到已安装的"Nginx"，点击"设置"
2. 进入"性能调整"标签
3. 按照下面的建议调整：
   - 工作进程数：设成和你服务器的CPU核心数一样
   - 连接数：设成5000-10000
   - 开启GZIP压缩：选"启用"
4. 点"保存"按钮，重启Nginx服务

### 2. 优化PostgreSQL数据库

1. 进入"软件商店"，找到已安装的"PostgreSQL管理器"，点击"设置"
2. 进入"性能调整"标签
3. 按照下面的建议调整：
   - 最大连接数：设成100-200
   - 共享缓冲区：设成系统内存的25%（比如4G内存就设成1G）
4. 点"保存"按钮，重启PostgreSQL服务

## 十、监控与维护

### 1. 查看日志

#### 1.1 查看网站访问日志

1. 进入"网站"管理
2. 找到你的网站，点击"设置"
3. 进入"日志"标签
4. 你可以查看谁访问了你的网站，有没有错误发生

#### 1.2 查看后端运行日志

1. 进入"Python项目"管理
2. 找到你的后端项目，点击"日志"
3. 你可以查看后端程序有没有出错
4. 同时可以查看`/www/wwwroot/gradpush/backend/logs/app.log`文件，获取更详细的后端日志

### 2. 定期备份（非常重要！）

备份就像给你的数据买保险，万一出问题了可以恢复。

#### 2.1 备份数据库

1. 进入"数据库"管理
2. 找到你的数据库，点击"备份"
3. 选择"定期备份"
4. 设置备份周期（比如每天备份一次）和保留天数（比如保留7天的备份）
5. 点"保存"按钮

#### 2.2 备份网站

1. 进入"网站"管理
2. 找到你的网站，点击"备份"
3. 选择备份内容（网站文件、数据库）
4. 选择"定期备份"
5. 设置备份周期和保留天数
6. 点"保存"按钮

## 十一、检查部署是否成功

1. **访问网站**：在浏览器里输入你的域名（比如`https://your-domain.com`），看看能不能正常显示登录页面
2. **测试登录**：尝试用账号密码登录系统，看看能不能正常登录
   - 默认管理员账号：用户名`admin`，密码`123456`
3. **测试文件上传**：上传一个测试文件，看看能不能正常上传
4. **测试数据保存**：在系统里创建一条记录，看看能不能正常保存

## 十二、常见问题及解决办法

### 1. 网站打不开怎么办？

- 检查Nginx服务是不是在运行
- 检查域名是不是正确
- 检查SSL证书是不是过期了
- 检查伪静态规则是不是正确配置

### 2. 登录不上系统怎么办？

- 检查后端服务是不是在运行
- 检查数据库是不是连接正常
- 检查密码是不是输错了
- 检查Nginx的反向代理是不是正确配置

### 3. 文件上传失败怎么办？

- 检查uploads目录及其子目录的权限是不是755或775
- 检查Nginx配置里的上传文件大小限制是不是足够大（client_max_body_size）
- 检查后端config.py里的MAX_CONTENT_LENGTH设置是不是足够大

### 4. 数据库连接失败怎么办？

- 检查PostgreSQL服务是不是在运行
- 检查数据库用户名和密码是不是正确
- 检查数据库连接字符串是不是写错了
- 检查PostgreSQL的监听地址是不是正确配置

### 5. 后端服务启动失败怎么办？

- 检查Python依赖是不是都安装成功了
- 检查端口5001是不是被其他程序占用了
- 检查logs/app.log文件，查看具体的错误信息
- 检查数据库连接是不是正常

---

好啦，以上就是GradPush系统的部署指南，尽量写得简单明白。如果还有不明白的地方，可以找个懂电脑的年轻人帮你看看。祝你部署成功！